<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<title>SimpleRouter示例</title>
	<style>
		.page {
			display: none;
		}

		.page.active {
			display: block;
			padding: 20px;
			background-color: #f5f5f5;
			border-radius: 8px;
		}

		nav {
			margin-bottom: 20px;
		}

		nav a {
			margin-right: 10px;
			text-decoration: none;
			color: #333;
		}

		nav a.active {
			color: #42b983;
			font-weight: bold;
		}
	</style>
</head>

<body>
	<nav id="nav"></nav>
	<div id="app">
		<!-- 路由内容将动态渲染到这里 -->
	</div>

	<!-- 引入路由类（二选一） -->
	<!-- <script src="simple-hash-router.js"></script> -->
	<script src="simple-history-router.js"></script>

	<script>
		// XSS防护函数
		function escape(str) {
			const div = document.createElement('div');
			div.textContent = str;
			return div.innerHTML;
		}

		// 路由配置
		const routes = [
			{
				path: "/",
				name: "首页",
				component: () => `
              <div class="page active">
                  <h1>首页</h1>
                  <p>欢迎来到首页！</p>
                  <button onclick="router.push('/user/123')">查看用户123</button>
                  <button onclick="router.push('/test')">访问不存在的页面</button>
              </div>
          `
			},
			{
				path: "/about",
				name: "关于我们",
				component: () => `
              <div class="page active">
                  <h1>关于我们</h1>
                  <p>这是一个基于SimpleRouter的单页应用示例</p>
              </div>
          `
			},
			{
				path: "/user/:id",
				name: "用户详情",
				component: (params) => `
              <div class="page active">
                  <h1>用户详情</h1>
                  <p>用户ID: <strong>${escape(params.id)}</strong></p>
                  <p>欢迎查看用户 ${escape(params.id)} 的详情！</p>
                  <button onclick="router.push('/')">返回首页</button>
              </div>
          `
			},
			{
				path: "*",
				component: () => `
              <div class="page active">
                  <h1>404 页面未找到</h1>
                  <p>您访问的页面不存在！</p>
                  <button onclick="router.push('/')">返回首页</button>
              </div>
          `
			}
		];

		// 路由守卫
		const beforeEach = (to, from, next) => {
			console.log("路由切换:", from ? from.path : "null", "→", to.path);

			// 模拟权限验证
			if (to.path.startsWith("/user") && to.params.id !== "123") {
				alert("您没有权限访问该用户！");
				router.push("/");
				return;
			}

			next();
		};

		// 实例化路由（二选一）
		// const router = new SimpleHashRouter({ routes, beforeEach });
		const router = new SimpleHistoryRouter({ routes, beforeEach });
	</script>
</body>

</html>