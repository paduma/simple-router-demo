<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>SimpleRouter Demo</title>
	<style>
		.page {
			display: none;
		}

		.page.active {
			display: block;
			padding: 20px;
			background-color: #f5f5f5;
			border-radius: 8px;
		}

		nav {
			margin-bottom: 20px;
		}

		nav a {
			margin-right: 10px;
			text-decoration: none;
			color: #333;
		}

		nav a.active {
			color: #42b983;
			font-weight: bold;
		}
	</style>
</head>

<body>
	<nav id="nav"></nav>
	<div id="app">
		<!-- Route content will be dynamically rendered here -->
	</div>

	<!-- Include router class (choose one) -->
	<!-- <script src="/client/simple-hash-router.js"></script> -->
	<script src="/client/simple-history-router.js"></script>

	<script>
		// XSS protection function
		function escape(str) {
			const div = document.createElement('div');
			div.textContent = str;
			return div.innerHTML;
		}

		// Route configuration
		const routes = [
			{
				path: "/",
				name: "Home",
				component: () => `
              <div class="page active">
                  <h1>Home</h1>
                  <p>Welcome to the home page!</p>
                  <button onclick="router.push('/user/123')">View User 123</button>
                  <button onclick="router.push('/test')">Visit Non-existent Page</button>
              </div>
          `
			},
			{
				path: "/about",
				name: "About",
				component: () => `
              <div class="page active">
                  <h1>About Us</h1>
                  <p>This is a single page application demo based on SimpleRouter</p>
              </div>
          `
			},
			{
				path: "/user/:id",
				name: "User Detail",
				component: (params) => `
              <div class="page active">
                  <h1>User Detail</h1>
                  <p>User ID: <strong>${escape(params.id)}</strong></p>
                  <p>Welcome to view user ${escape(params.id)}'s details!</p>
                  <button onclick="router.push('/')">Back to Home</button>
              </div>
          `
			},
			{
				path: "*",
				component: () => `
              <div class="page active">
                  <h1>404 Page Not Found</h1>
                  <p>The page you are looking for does not exist!</p>
                  <button onclick="router.push('/')">Back to Home</button>
              </div>
          `
			}
		];

		// Route guard
		const beforeEach = (to, from, next) => {
			console.log("Route change:", from ? from.path : "null", "â†’", to.path);

			// Simulate permission verification
			if (to.path.startsWith("/user") && to.params.id !== "123") {
				alert("You don't have permission to access this user!");
				router.push("/");
				return;
			}

			next();
		};

		// Instantiate router (choose one)
		// const router = new SimpleHashRouter({ routes, beforeEach });
		const router = new SimpleHistoryRouter({ routes, beforeEach });
	</script>
</body>

</html>
